<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyMate - رفيق دراستك الذكي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #9b59b6;
            --text-color: #2c3e50;
            --bg-color: #f9f9f9;
            --card-bg: #ffffff;
            --shadow: rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .dark-mode {
            --primary-color: #5dade2;
            --secondary-color: #58d68d;
            --accent-color: #bb8fce;
            --text-color: #ecf0f1;
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: var(--transition);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(52, 152, 219, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(46, 204, 113, 0.05) 0%, transparent 20%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: var(--card-bg);
            box-shadow: 0 2px 15px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 15px 0;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            animation: logoFloat 3s ease-in-out infinite;
            cursor: pointer;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }

        .logo i {
            margin-left: 10px;
            font-size: 28px;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mode-toggle, .menu-toggle {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--text-color);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }

        .mode-toggle:hover, .menu-toggle:hover {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }

        /* Menu Styles */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .menu-panel {
            position: fixed;
            top: 0;
            left: -50%;
            width: 50%;
            height: 100%;
            background-color: var(--card-bg);
            box-shadow: 5px 0 15px var(--shadow);
            z-index: 1001;
            padding: 20px;
            overflow-y: auto;
            transition: left 0.4s ease;
            display: flex;
            flex-direction: column;
        }

        .menu-panel.active {
            left: 0;
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--card-bg);
        }

        .menu-title {
            font-size: 22px;
            color: var(--primary-color);
        }

        .close-menu {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-color);
            cursor: pointer;
        }

        .menu-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .menu-items {
            list-style: none;
            margin-bottom: 30px;
        }

        .menu-item {
            margin-bottom: 15px;
            opacity: 0;
            transform: translateX(-20px);
            animation: slideInRight 0.5s forwards;
        }

        @keyframes slideInRight {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .menu-item:nth-child(1) { animation-delay: 0.1s; }
        .menu-item:nth-child(2) { animation-delay: 0.2s; }
        .menu-item:nth-child(3) { animation-delay: 0.3s; }
        .menu-item:nth-child(4) { animation-delay: 0.4s; }
        .menu-item:nth-child(5) { animation-delay: 0.5s; }
        .menu-item:nth-child(6) { animation-delay: 0.6s; }
        .menu-item:nth-child(7) { animation-delay: 0.7s; }
        .menu-item:nth-child(8) { animation-delay: 0.8s; }
        .menu-item:nth-child(9) { animation-delay: 0.9s; }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 16px;
            transition: var(--transition);
        }

        .menu-link:hover, .menu-link.active {
            background-color: var(--primary-color);
            color: white;
            transform: translateX(5px);
        }

        .menu-link i {
            margin-left: 10px;
            font-size: 18px;
        }

        .menu-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid var(--card-bg);
        }

        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-left: 10px;
            overflow: hidden;
            animation: pulse 2s infinite;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .user-status {
            font-size: 12px;
            color: var(--secondary-color);
        }

        .menu-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .menu-action-btn {
            background: none;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            color: var(--text-color);
            text-align: right;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }

        .menu-action-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .menu-action-btn i {
            margin-left: 10px;
        }

        /* Main Content */
        main {
            padding: 40px 0;
            min-height: calc(100vh - 160px);
        }

        .page {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page.active {
            display: block;
        }

        .page-title {
            font-size: 28px;
            margin-bottom: 30px;
            color: var(--primary-color);
            text-align: center;
            position: relative;
        }

        .page-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 3px;
            background: var(--gradient);
            border-radius: 3px;
        }

        /* Home Page */
        .welcome-section {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .welcome-title {
            font-size: 32px;
            margin-bottom: 15px;
            color: var(--primary-color);
            animation: bounceIn 1s;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* قسم الحكمة التشجيعية - تم التعديل */
        .wisdom-section {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 35px;
            margin: 30px 0;
            box-shadow: 0 4px 20px var(--shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
            border-right: 5px solid var(--primary-color);
            border-left: 5px solid var(--accent-color);
        }

        .wisdom-icon {
            font-size: 50px;
            margin-bottom: 20px;
            color: var(--accent-color);
            animation: float 3s ease-in-out infinite;
        }

        .wisdom-text {
            font-size: 26px;
            line-height: 1.6;
            color: var(--text-color);
            font-style: italic;
            margin-bottom: 15px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .wisdom-author {
            font-size: 18px;
            color: var(--secondary-color);
            text-align: center;
            font-weight: 500;
        }

        .wisdom-timer {
            font-size: 14px;
            color: var(--accent-color);
            margin-top: 15px;
            opacity: 0.9;
            font-weight: 500;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .feature-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px var(--shadow);
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient);
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px var(--shadow);
        }

        .feature-icon {
            font-size: 50px;
            margin-bottom: 15px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .feature-title {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        /* Study Materials Page */
        .study-materials-container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px var(--shadow);
            animation: slideInUp 0.5s;
        }

        .study-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .study-level {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .study-branch {
            font-size: 18px;
            color: var(--secondary-color);
        }

        .materials-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .material-card {
            background-color: var(--bg-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow);
            transition: var(--transition);
            border-left: 4px solid var(--primary-color);
            cursor: pointer;
        }

        .material-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .material-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .material-level {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .level-excellent {
            background-color: rgba(46, 204, 113, 0.2);
            color: #27ae60;
        }

        .level-good {
            background-color: rgba(52, 152, 219, 0.2);
            color: #2980b9;
        }

        .level-needs-improvement {
            background-color: rgba(231, 76, 60, 0.2);
            color: #c0392b;
        }

        .material-details {
            margin-top: 10px;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .improvement-tip {
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(231, 76, 60, 0.1);
            border-radius: 8px;
            font-size: 14px;
            color: #c0392b;
            border-right: 3px solid #e74c3c;
        }

        /* Profile Page */
        .profile-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px var(--shadow);
            animation: slideInUp 0.5s;
        }

        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
        }

        .profile-image-container {
            position: relative;
            margin-left: 20px;
        }

        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            overflow: hidden;
            cursor: pointer;
            animation: pulse 2s infinite;
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-image-edit {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background-color: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }

        .profile-image-edit:hover {
            transform: scale(1.1);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .profile-email {
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .profile-id {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.7;
        }

        .profile-form {
            display: grid;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input, .form-select {
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .save-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
            font-weight: bold;
        }

        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Settings Page */
        .settings-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-section {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px var(--shadow);
            animation: slideInUp 0.5s;
        }

        .settings-section:nth-child(1) { animation-delay: 0.1s; }
        .settings-section:nth-child(2) { animation-delay: 0.2s; }
        .settings-section:nth-child(3) { animation-delay: 0.3s; }
        .settings-section:nth-child(4) { animation-delay: 0.4s; }

        .settings-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .settings-title i {
            margin-left: 10px;
        }

        .settings-options {
            display: grid;
            gap: 15px;
        }

        .option-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .option-label {
            font-weight: 500;
        }

        .select-input, .slider-input {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .slider-input {
            flex: 1;
        }

        .slider-value {
            min-width: 40px;
            text-align: center;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        .toggle-input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        .toggle-input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        /* Chat Bot */
        .chat-bot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99;
        }

        .chat-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            animation: pulse 2s infinite;
        }

        .chat-icon:hover {
            transform: scale(1.1);
        }

        .chat-window {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 350px;
            height: 450px;
            background-color: var(--card-bg);
            border-radius: 15px;
            box-shadow: 0 5px 25px var(--shadow);
            display: flex;
            flex-direction: column;
            z-index: 101;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.9);
            transition: var(--transition);
        }

        .chat-window.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .chat-header {
            background: var(--gradient);
            color: white;
            padding: 15px;
            border-radius: 15px 15px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-title {
            display: flex;
            align-items: center;
            font-size: 18px;
        }

        .chat-title i {
            margin-left: 10px;
        }

        .close-chat {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            line-height: 1.4;
            animation: messageAppear 0.3s;
        }

        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background: var(--gradient);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            align-self: flex-start;
            background-color: var(--bg-color);
            color: var(--text-color);
            border-bottom-left-radius: 5px;
        }

        .loading-message {
            align-self: flex-start;
            background-color: var(--bg-color);
            color: var(--text-color);
            border-bottom-left-radius: 5px;
            font-style: italic;
        }

        .chat-input-container {
            display: flex;
            padding: 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 25px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .send-btn {
            background: var(--gradient);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 18px;
        }

        .send-btn:disabled {
            background: #ccc;
            opacity: 0.7;
            cursor: not-allowed;
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.1);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-logo {
            width: 120px;
            height: 120px;
            margin-bottom: 20px;
            position: relative;
        }

        .robot-head {
            width: 80px;
            height: 80px;
            background-color: white;
            border-radius: 20px;
            position: relative;
            margin: 0 auto;
            animation: pulse 2s infinite;
        }

        .robot-eye {
            width: 15px;
            height: 15px;
            background-color: var(--primary-color);
            border-radius: 50%;
            position: absolute;
            top: 25px;
            animation: blink 3s infinite;
        }

        .robot-eye.left {
            left: 20px;
        }

        .robot-eye.right {
            right: 20px;
        }

        .robot-mouth {
            width: 30px;
            height: 5px;
            background-color: var(--primary-color);
            border-radius: 5px;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .loading-text {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-top: 20px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes blink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }

        /* Login Modal */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .login-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .login-container {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateY(-20px) scale(0.9);
            transition: transform 0.3s ease;
            animation: modalAppear 0.5s;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: translateY(-20px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .login-modal.active .login-container {
            transform: translateY(0) scale(1);
        }

        .login-title {
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .login-form {
            display: grid;
            gap: 15px;
        }

        .login-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: bold;
            transition: var(--transition);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* File Input */
        .file-input {
            display: none;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--secondary-color);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 15px var(--shadow);
            z-index: 1002;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .toast.show {
            opacity: 1;
            visibility: visible;
        }

        /* Chats Page */
        .chats-container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px var(--shadow);
            animation: slideInUp 0.5s;
            display: flex;
            flex-direction: column;
            height: 70vh;
        }

        .chats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .chats-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background-color: var(--bg-color);
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chats-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .chats-input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 25px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-color: var(--bg-color);
            color: var(--text-color);
            font-size: 14px;
        }

        .chats-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .send-chats-btn {
            background: var(--gradient);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 18px;
        }

        .send-chats-btn:disabled {
            background: #ccc;
            opacity: 0.7;
            cursor: not-allowed;
        }

        .send-chats-btn:hover:not(:disabled) {
            transform: scale(1.1);
        }

        /* زر المحادثة الجديد في صفحة المحادثات - تم التعديل */
        .chats-new-chat-bottom {
            text-align: center;
            margin-top: 10px;
        }

        .chats-new-chat-btn {
            background: var(--gradient);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }

        .chats-new-chat-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        /* Study Books Page */
        .study-books-container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px var(--shadow);
            animation: slideInUp 0.5s;
        }

        .books-filter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .books-category {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .books-branch {
            font-size: 18px;
            color: var(--secondary-color);
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .book-card {
            background-color: var(--bg-color);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 12px var(--shadow);
            transition: var(--transition);
            border-left: 4px solid var(--accent-color);
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 18px var(--shadow);
        }

        .book-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .book-logo {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            margin-left: 15px;
            flex-shrink: 0;
        }

        .book-info {
            flex: 1;
        }

        .book-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .book-type {
            font-size: 14px;
            color: var(--secondary-color);
        }

        .book-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .book-btn {
            flex: 1;
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 500;
        }

        .textbook-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .summary-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .book-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .book-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* صفحة الامتحانات الجديدة */
        .exams-container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px var(--shadow);
            animation: slideInUp 0.5s;
        }

        .exams-filter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .exams-category {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .exams-branch {
            font-size: 18px;
            color: var(--secondary-color);
        }

        .exams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .exam-card {
            background-color: var(--bg-color);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px var(--shadow);
            transition: var(--transition);
            border-left: 4px solid var(--accent-color);
        }

        .exam-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .exam-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .exam-date {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .exam-details {
            margin-top: 10px;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .exam-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .exam-btn {
            flex: 1;
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 500;
        }

        .start-exam-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .review-exam-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .exam-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .exam-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .menu-panel {
                width: 80%;
                left: -80%;
            }
            
            .chat-window {
                width: 300px;
            }
            
            .header-content {
                padding: 0 10px;
            }
            
            .logo {
                position: static;
                transform: none;
            }
            
            .materials-grid {
                grid-template-columns: 1fr;
            }
            
            .chats-container {
                height: 65vh;
            }
            
            .wisdom-text {
                font-size: 22px;
            }
            
            .books-grid {
                grid-template-columns: 1fr;
            }
            
            .books-filter {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .exams-grid {
                grid-template-columns: 1fr;
            }
            
            .exams-filter {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .menu-panel {
                width: 90%;
                left: -90%;
            }
            
            .chat-window {
                width: 280px;
                right: 10px;
            }
            
            .chat-bot {
                right: 10px;
                bottom: 10px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .study-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .chats-container {
                padding: 20px;
                height: 60vh;
            }
            
            .wisdom-text {
                font-size: 20px;
            }
            
            .book-actions {
                flex-direction: column;
            }
            
            .exam-actions {
                flex-direction: column;
            }
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: var(--primary-color);
            border-radius: 50%;
            opacity: 0.2;
            animation: floatParticle 15s infinite linear;
        }

        @keyframes floatParticle {
            0% {
                transform: translateY(0) translateX(0);
            }
            100% {
                transform: translateY(-100vh) translateX(100px);
            }
        }
    </style>
</head>
<body>
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">
            <div class="robot-head">
                <div class="robot-eye left"></div>
                <div class="robot-eye right"></div>
                <div class="robot-mouth"></div>
            </div>
        </div>
        <div class="loading-text">StudyMate</div>
    </div>

    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-container">
            <h2 class="login-title" data-key="login">تسجيل الدخول</h2>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="username" data-key="username">اسم المستخدم</label>
                    <input type="text" id="username" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="password" data-key="password">كلمة المرور</label>
                    <input type="password" id="password" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="rememberMe">
                        تذكرني
                    </label>
                </div>
                <button type="submit" class="login-btn" data-key="login">تسجيل الدخول</button>
            </form>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
                <div class="logo" id="logo">
                    <span>StudyMate</span>
                    <i class="fas fa-robot"></i>
                </div>
                <div class="header-right">
                    <button class="mode-toggle" id="modeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Menu Panel -->
    <div class="menu-overlay" id="menuOverlay"></div>
    <div class="menu-panel" id="menuPanel">
        <div class="menu-header">
            <h2 class="menu-title" data-key="menu">القائمة</h2>
            <button class="close-menu" id="closeMenu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="menu-content">
            <ul class="menu-items">
                <li class="menu-item">
                    <a href="#" class="menu-link active" data-page="home">
                        <i class="fas fa-home"></i>
                        <span data-key="home">الرئيسية</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-page="analytics">
                        <i class="fas fa-chart-bar"></i>
                        <span data-key="analytics">التحليلات</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-page="schedule">
                        <i class="fas fa-calendar-alt"></i>
                        <span data-key="schedule">الجدول</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-page="study-materials">
                        <i class="fas fa-book"></i>
                        <span>موادي الدراسية</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-page="study-books">
                        <i class="fas fa-book-open"></i>
                        <span>مكتبة الكتب</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-page="exams">
                        <i class="fas fa-file-alt"></i>
                        <span>الامتحانات</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-page="chats">
                        <i class="fas fa-comments"></i>
                        <span data-key="chats">المحادثات</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-page="profile">
                        <i class="fas fa-user"></i>
                        <span data-key="profile">البروفايل</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" data-page="settings">
                        <i class="fas fa-cog"></i>
                        <span data-key="settings">الإعدادات</span>
                    </a>
                </li>
            </ul>
            
            <div class="menu-footer">
                <div class="user-info">
                    <div class="user-avatar" id="menuUserAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="menuUserName">زائر</div>
                        <div class="user-status" data-key="student">طالب</div>
                    </div>
                </div>
                
                <div class="menu-actions">
                    <button class="menu-action-btn" id="helpBtn">
                        <i class="fas fa-question-circle"></i>
                        <span data-key="help">المساعدة</span>
                    </button>
                    <button class="menu-action-btn" id="feedbackBtn">
                        <i class="fas fa-comment-alt"></i>
                        <span data-key="feedback">إرسال ملاحظات</span>
                    </button>
                    <button class="menu-action-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span data-key="logout">تسجيل الخروج</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Home Page -->
            <div class="page active" id="home">
                <h1 class="page-title" data-key="welcome">مرحباً بك في StudyMate</h1>
                <div class="welcome-section">
                    <h2 class="welcome-title" data-key="smartCompanion">رفيق دراستك الذكي</h2>
                </div>
                
                <!-- قسم الحكمة التشجيعية - تم التعديل -->
                <div class="wisdom-section">
                    <div class="wisdom-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <div class="wisdom-text" id="wisdomText">
                        "العلم في الصغر كالنقش في الحجر"
                    </div>
                    <div class="wisdom-author" id="wisdomAuthor">- مثل عربي</div>
                    <div class="wisdom-timer" id="wisdomTimer">
                        ستتغير الحكمة تلقائياً عند الساعة 12 صباحاً ومساءً
                    </div>
                </div>
                
                <div class="features-grid">
                    <div class="feature-card" data-action="chats">
                        <div class="feature-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <h3 class="feature-title" data-key="smartAssistant">مساعد ذكي</h3>
                        <p data-key="smartAssistantDesc">احصل على إجابات لأسئلتك من مساعدنا الذكي</p>
                    </div>
                    <div class="feature-card" data-action="schedule">
                        <div class="feature-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <h3 class="feature-title" data-key="tasks">مهام ومواعيد</h3>
                        <p data-key="tasksDesc">تتبع المهام والمواعيد الهامة بسهولة</p>
                    </div>
                    <div class="feature-card" data-action="analytics">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3 class="feature-title" data-key="progress">تتبع التقدم</h3>
                        <p data-key="progressDesc">راقب تقدمك الدراسي مع تقارير مفصلة</p>
                    </div>
                    <div class="feature-card" data-action="study-materials">
                        <div class="feature-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <h3 class="feature-title" data-key="studyMaterials">مواد دراسية</h3>
                        <p data-key="studyMaterialsDesc">تنظيم المواد الدراسية وملاحظاتك في مكان واحد</p>
                    </div>
                    <div class="feature-card" data-action="study-books">
                        <div class="feature-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h3 class="feature-title">مكتبة الكتب</h3>
                        <p>الوصول إلى الكتب الدراسية والملخصات</p>
                    </div>
                    <div class="feature-card" data-action="exams">
                        <div class="feature-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h3 class="feature-title">الامتحانات</h3>
                        <p>تدرب على الامتحانات وتتبع أدائك</p>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div class="page" id="analytics">
                <h1 class="page-title" data-key="analytics">التحليلات</h1>
                <div class="study-materials-container">
                    <div class="study-info">
                        <div class="study-level" id="studyLevel">الصف: غير محدد</div>
                        <div class="study-branch" id="studyBranch">الشعبة: غير محددة</div>
                    </div>
                    <div class="materials-grid" id="materialsGrid">
                        <!-- سيتم ملء المواد الدراسية ديناميكياً -->
                    </div>
                </div>
            </div>

            <!-- Schedule Page -->
            <div class="page" id="schedule">
                <h1 class="page-title" data-key="schedule">جدول الدراسة</h1>
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <h3 class="feature-title" data-key="monday">الاثنين</h3>
                        <p data-key="mondaySchedule">رياضيات: 9-11 ص / علوم: 2-4 م</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <h3 class="feature-title" data-key="tuesday">الثلاثاء</h3>
                        <p data-key="tuesdaySchedule">لغة عربية: 10-12 ص / تاريخ: 3-5 م</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <h3 class="feature-title" data-key="wednesday">الأربعاء</h3>
                        <p data-key="wednesdaySchedule">رياضيات: 9-11 ص / فيزياء: 1-3 م</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <h3 class="feature-title" data-key="thursday">الخميس</h3>
                        <p data-key="thursdaySchedule">كيمياء: 10-12 ص / أحياء: 2-4 م</p>
                    </div>
                </div>
            </div>

            <!-- Study Materials Page -->
            <div class="page" id="study-materials">
                <h1 class="page-title">موادي الدراسية</h1>
                <div class="study-materials-container">
                    <div class="study-info">
                        <div class="study-level" id="studyLevelMaterials">الصف: غير محدد</div>
                        <div class="study-branch" id="studyBranchMaterials">الشعبة: غير محددة</div>
                    </div>
                    <div class="materials-grid" id="materialsListGrid">
                        <!-- سيتم ملء قائمة المواد الدراسية ديناميكياً -->
                    </div>
                </div>
            </div>

            <!-- Study Books Page -->
            <div class="page" id="study-books">
                <h1 class="page-title">مكتبة الكتب الدراسية</h1>
                <div class="study-books-container">
                    <div class="books-filter">
                        <div class="books-category" id="booksCategory">الصف: الصف الثاني الثانوي</div>
                        <div class="books-branch" id="booksBranch">الشعبة: علمي</div>
                    </div>
                    <div class="books-grid" id="booksGrid">
                        <!-- سيتم ملء الكتب الدراسية ديناميكياً -->
                    </div>
                </div>
            </div>

            <!-- Exams Page - الصفحة الجديدة -->
            <div class="page" id="exams">
                <h1 class="page-title">الامتحانات</h1>
                <div class="exams-container">
                    <div class="exams-filter">
                        <div class="exams-category" id="examsCategory">الصف: الصف الثاني الثانوي</div>
                        <div class="exams-branch" id="examsBranch">الشعبة: علمي</div>
                    </div>
                    <div class="exams-grid" id="examsGrid">
                        <!-- سيتم ملء الامتحانات ديناميكياً -->
                    </div>
                </div>
            </div>

            <!-- Chats Page -->
            <div class="page" id="chats">
                <h1 class="page-title" data-key="chats">المحادثات</h1>
                <div class="chats-container">
                    <div class="chats-header">
                        <h3>المحادثات السابقة</h3>
                    </div>
                    <div class="chats-messages" id="chatsMessages">
                        <!-- سيتم ملء المحادثات هنا -->
                    </div>
                    <div class="chats-input-container">
                        <input type="text" class="chats-input" id="chatsInput" placeholder="اكتب رسالتك هنا..." data-key="chatPlaceholder">
                        <button class="send-chats-btn" id="sendChatsMessage">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="chats-new-chat-bottom">
                        <button class="chats-new-chat-btn" id="chatsNewChatBtn">
                            <i class="fas fa-plus"></i>
                            بدء محادثة جديدة
                        </button>
                    </div>
                </div>
            </div>

            <!-- Profile Page -->
            <div class="page" id="profile">
                <h1 class="page-title" data-key="profile">البروفايل</h1>
                <div class="profile-container">
                    <div class="profile-header">
                        <div class="profile-image-container">
                            <div class="profile-image" id="profileImage">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="profile-image-edit" id="profileImageEdit">
                                <i class="fas fa-camera"></i>
                            </div>
                            <input type="file" id="profileImageInput" class="file-input" accept="image/*">
                        </div>
                        <div class="profile-info">
                            <h2 class="profile-name" id="profileName">محمد أحمد</h2>
                            <p class="profile-email" id="profileEmail">mohamed@example.com</p>
                            <p class="profile-id">ID: <span id="profileUserId">STU2023001</span></p>
                        </div>
                    </div>
                    <form class="profile-form" id="profileForm">
                        <div class="form-group">
                            <label class="form-label" for="name" data-key="name">الاسم</label>
                            <input type="text" id="name" class="form-input" value="محمد أحمد">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="email" data-key="email">البريد الإلكتروني</label>
                            <input type="email" id="email" class="form-input" value="mohamed@example.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="phone" data-key="phone">رقم الهاتف</label>
                            <input type="tel" id="phone" class="form-input" value="+20123456789">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="grade">الصف/المستوى</label>
                            <select id="grade" class="form-select">
                                <option value="">اختر الصف الدراسي</option>
                                <option value="الصف الأول الابتدائي">الصف الأول الابتدائي</option>
                                <option value="الصف الثاني الابتدائي">الصف الثاني الابتدائي</option>
                                <option value="الصف الثالث الابتدائي">الصف الثالث الابتدائي</option>
                                <option value="الصف الرابع الابتدائي">الصف الرابع الابتدائي</option>
                                <option value="الصف الخامس الابتدائي">الصف الخامس الابتدائي</option>
                                <option value="الصف السادس الابتدائي">الصف السادس الابتدائي</option>
                                <option value="الصف الأول الإعدادي">الصف الأول الإعدادي</option>
                                <option value="الصف الثاني الإعدادي">الصف الثاني الإعدادي</option>
                                <option value="الصف الثالث الإعدادي">الصف الثالث الإعدادي</option>
                                <option value="الصف الأول الثانوي">الصف الأول الثانوي</option>
                                <option value="الصف الثاني الثانوي">الصف الثاني الثانوي</option>
                                <option value="الصف الثالث الثانوي">الصف الثالث الثانوي</option>
                            </select>
                        </div>
                        <div class="form-group" id="branchGroup" style="display: none;">
                            <label class="form-label" for="branch">الشعبة/التخصص</label>
                            <select id="branch" class="form-select">
                                <option value="">اختر الشعبة</option>
                                <option value="علمي">علمي</option>
                                <option value="أدبي">أدبي</option>
                                <option value="علمي علوم">علمي علوم</option>
                                <option value="علمي رياضة">علمي رياضة</option>
                            </select>
                        </div>
                        <button type="submit" class="save-btn" data-key="save">حفظ التغييرات</button>
                    </form>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="settings">
                <h1 class="page-title" data-key="settings">الإعدادات</h1>
                <div class="settings-container">
                    <div class="settings-section">
                        <h2 class="settings-title">
                            <i class="fas fa-language"></i>
                            <span data-key="language">اللغة</span>
                        </h2>
                        <div class="settings-options">
                            <div class="option-row">
                                <span class="option-label" data-key="appLanguage">لغة التطبيق</span>
                                <select class="select-input" id="languageSelect">
                                    <option value="ar">العربية</option>
                                    <option value="en">English</option>
                                    <option value="fr">Français</option>
                                    <option value="es">Español</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="settings-title">
                            <i class="fas fa-palette"></i>
                            <span data-key="appearance">المظهر</span>
                        </h2>
                        <div class="settings-options">
                            <div class="option-row">
                                <span class="option-label" data-key="darkMode">الوضع الليلي</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="darkModeToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="settings-title">
                            <i class="fas fa-bell"></i>
                            <span data-key="notifications">الإشعارات</span>
                        </h2>
                        <div class="settings-options">
                            <div class="option-row">
                                <span class="option-label" data-key="reminderNotifications">إشعارات التذكير</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="reminderNotifications">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h2 class="settings-title">
                            <i class="fas fa-font"></i>
                            <span data-key="fontSize">حجم الخط</span>
                        </h2>
                        <div class="settings-options">
                            <div class="option-row">
                                <span class="option-label" data-key="fontSize">حجم الخط</span>
                                <div class="slider-container">
                                    <input type="range" min="12" max="24" value="16" class="slider-input" id="fontSizeSlider">
                                    <span class="slider-value" id="fontSizeValue">16px</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <button class="save-btn" id="saveSettingsBtn" data-key="save">حفظ الإعدادات</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Chat Bot -->
    <div class="chat-bot">
        <div class="chat-icon" id="chatIcon">
            <i class="fas fa-robot"></i>
        </div>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <div class="chat-title">
                    <i class="fas fa-robot"></i>
                    <span data-key="assistant">مساعد StudyMate</span>
                </div>
                <button class="close-chat" id="closeChat">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message" data-key="welcomeMessage">
                    مرحباً! أنا مساعدك الدراسي. كيف يمكنني مساعدتك اليوم؟
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chatInput" placeholder="اكتب رسالتك هنا..." data-key="chatPlaceholder">
                <button class="send-btn" id="sendMessage">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const loadingScreen = document.getElementById('loadingScreen');
        const loginModal = document.getElementById('loginModal');
        const loginForm = document.getElementById('loginForm');
        const modeToggle = document.getElementById('modeToggle');
        const menuToggle = document.getElementById('menuToggle');
        const menuOverlay = document.getElementById('menuOverlay');
        const menuPanel = document.getElementById('menuPanel');
        const closeMenu = document.getElementById('closeMenu');
        const menuLinks = document.querySelectorAll('.menu-link');
        const pages = document.querySelectorAll('.page');
        const chatIcon = document.getElementById('chatIcon');
        const chatWindow = document.getElementById('chatWindow');
        const closeChat = document.getElementById('closeChat');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendMessage = document.getElementById('sendMessage');
        const languageSelect = document.getElementById('languageSelect');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const fontSizeSlider = document.getElementById('fontSizeSlider');
        const fontSizeValue = document.getElementById('fontSizeValue');
        const profileForm = document.getElementById('profileForm');
        const profileName = document.getElementById('profileName');
        const profileEmail = document.getElementById('profileEmail');
        const profileUserId = document.getElementById('profileUserId');
        const menuUserName = document.getElementById('menuUserName');
        const menuUserAvatar = document.getElementById('menuUserAvatar');
        const helpBtn = document.getElementById('helpBtn');
        const feedbackBtn = document.getElementById('feedbackBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const reminderNotifications = document.getElementById('reminderNotifications');
        const profileImage = document.getElementById('profileImage');
        const profileImageEdit = document.getElementById('profileImageEdit');
        const profileImageInput = document.getElementById('profileImageInput');
        const gradeInput = document.getElementById('grade');
        const branchInput = document.getElementById('branch');
        const branchGroup = document.getElementById('branchGroup');
        const rememberMe = document.getElementById('rememberMe');
        const nameInput = document.getElementById('name');
        const emailInput = document.getElementById('email');
        const phoneInput = document.getElementById('phone');
        const particlesContainer = document.getElementById('particles');
        const featureCards = document.querySelectorAll('.feature-card[data-action]');
        const materialsGrid = document.getElementById('materialsGrid');
        const studyLevel = document.getElementById('studyLevel');
        const studyBranch = document.getElementById('studyBranch');
        const studyLevelMaterials = document.getElementById('studyLevelMaterials');
        const studyBranchMaterials = document.getElementById('studyBranchMaterials');
        const materialsListGrid = document.getElementById('materialsListGrid');
        const logo = document.getElementById('logo');
        const toast = document.getElementById('toast');
        const saveSettingsBtn = document.getElementById('saveSettingsBtn');
        const chatsMessages = document.getElementById('chatsMessages');
        const chatsInput = document.getElementById('chatsInput');
        const sendChatsMessage = document.getElementById('sendChatsMessage');
        const wisdomText = document.getElementById('wisdomText');
        const wisdomAuthor = document.getElementById('wisdomAuthor');
        const wisdomTimer = document.getElementById('wisdomTimer');
        const chatsNewChatBtn = document.getElementById('chatsNewChatBtn');
        const booksGrid = document.getElementById('booksGrid');
        const booksCategory = document.getElementById('booksCategory');
        const booksBranch = document.getElementById('booksBranch');
        const examsGrid = document.getElementById('examsGrid');
        const examsCategory = document.getElementById('examsCategory');
        const examsBranch = document.getElementById('examsBranch');

        // App State
        let isDarkMode = localStorage.getItem('darkMode') === 'true';
        let currentLanguage = localStorage.getItem('language') || 'ar';
        let currentFontSize = localStorage.getItem('fontSize') || '16';
        let currentUser = null;
        let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
        let wisdomChangeTimeout = null;
        let selectedSubject = null;

        // Webhook URL
        const WEBHOOK_URL = 'https://a7xed.app.n8n.cloud/webhook/311b12cd-34a7-45d4-8a45-6de833346a2d';

        // مجموعة الحكم التشجيعية
        const wisdomMessages = [
            {
                text: "العلم في الصغر كالنقش في الحجر",
                author: "مثل عربي"
            },
            {
                text: "من جد وجد، ومن زرع حصد",
                author: "مثل عربي"
            },
            {
                text: "لا تؤجل عمل اليوم إلى الغد",
                author: "مثل إنجليزي"
            },
            {
                text: "النجاح هو مجموع الجهود الصغيرة المتكررة يومياً",
                author: "روبرت كولير"
            },
            {
                text: "التعليم هو أقوى سلاح يمكنك استخدامه لتغيير العالم",
                author: "نيلسون مانديلا"
            },
            {
                text: "العقل كالمظلة، يعمل فقط عندما يكون مفتوحاً",
                author: "فرانك زابا"
            },
            {
                text: "لا تيأس، فعادة ما يكون آخر مفتاح في مجموعة المفاتيح هو الذي سيفتح الباب",
                author: "مثل صيني"
            },
            {
                text: "الاستثمار في المعرفة يدفع أفضل الفوائد",
                author: "بنجامين فرانكلين"
            },
            {
                text: "التعلم ليس من أجل المدرسة، بل من أجل الحياة",
                author: "سينيكا"
            },
            {
                text: "الطموح هو الطريق إلى النجاح، والمثابرة هي السيارة التي تصل بك",
                author: "بيل برادلي"
            }
        ];

        // المواد الدراسية لكل صف وشعبة
        const studyMaterials = {
            "الصف الأول الثانوي": {
                "علمي": [
                    { name: "اللغة العربية", level: "excellent", details: "مستوى ممتاز في القواعد والأدب", needsImprovement: false },
                    { name: "اللغة الإنجليزية", level: "good", details: "مستوى جيد في القراءة والمحادثة", needsImprovement: false },
                    { name: "الرياضيات", level: "needs-improvement", details: "تحتاج لتركيز أكثر في الجبر", needsImprovement: true, tip: "ركز على حل تمارين الجبر يومياً لمدة 30 دقيقة" },
                    { name: "الفيزياء", level: "good", details: "مستوى جيد في الميكانيكا", needsImprovement: false },
                    { name: "الكيمياء", level: "excellent", details: "مستوى ممتاز في التفاعلات الكيميائية", needsImprovement: false },
                    { name: "الأحياء", level: "good", details: "مستوى جيد في علم الوراثة", needsImprovement: false }
                ],
                "أدبي": [
                    { name: "اللغة العربية", level: "excellent", details: "مستوى ممتاز في النحو والصرف", needsImprovement: false },
                    { name: "اللغة الإنجليزية", level: "good", details: "مستوى جيد في القواعد والمحادثة", needsImprovement: false },
                    { name: "التاريخ", level: "excellent", details: "مستوى ممتاز في التاريخ الإسلامي", needsImprovement: false },
                    { name: "الجغرافيا", level: "needs-improvement", details: "تحتاج لتحسين في الخرائط", needsImprovement: true, tip: "تدرب على رسم الخرائط ودراسة التضاريس" },
                    { name: "الفلسفة", level: "good", details: "مستوى جيد في المنطق", needsImprovement: false },
                    { name: "علم النفس", level: "good", details: "مستوى جيد في نظريات التعلم", needsImprovement: false }
                ]
            },
            "الصف الثاني الثانوي": {
                "علمي": [
                    { name: "اللغة العربية", level: "good", details: "مستوى جيد في البلاغة", needsImprovement: false },
                    { name: "اللغة الإنجليزية", level: "excellent", details: "مستوى ممتاز في الكتابة", needsImprovement: false },
                    { name: "الرياضيات", level: "needs-improvement", details: "تحتاج لتحسين في التفاضل", needsImprovement: true, tip: "ركز على فهم قواعد التفاضل وحل تمارين إضافية" },
                    { name: "الفيزياء", level: "good", details: "مستوى جيد في الكهرباء", needsImprovement: false },
                    { name: "الكيمياء", level: "excellent", details: "مستوى ممتاز في الكيمياء العضوية", needsImprovement: false },
                    { name: "الأحياء", level: "needs-improvement", details: "تحتاج لتحسين في علم الوراثة", needsImprovement: true, tip: "ركز على فهم قوانين مندل وحل المسائل الوراثية" }
                ],
                "أدبي": [
                    { name: "اللغة العربية", level: "excellent", details: "مستوى ممتاز في الأدب", needsImprovement: false },
                    { name: "اللغة الإنجليزية", level: "good", details: "مستوى جيد في القراءة", needsImprovement: false },
                    { name: "التاريخ", level: "needs-improvement", details: "تحتاج لتحسين في التاريخ الحديث", needsImprovement: true, tip: "ركز على دراسة الأحداث التاريخية بالترتيب الزمني" },
                    { name: "الجغرافيا", level: "good", details: "مستوى جيد في الجغرافيا البشرية", needsImprovement: false },
                    { name: "الفلسفة", level: "excellent", details: "مستوى ممتاز في الفلسفة الإسلامية", needsImprovement: false },
                    { name: "علم النفس", level: "good", details: "مستوى جيد في علم النفس الاجتماعي", needsImprovement: false }
                ]
            },
            "الصف الثالث الثانوي": {
                "علمي علوم": [
                    { name: "اللغة العربية", level: "good", details: "مستوى جيد في النصوص", needsImprovement: false },
                    { name: "اللغة الإنجليزية", level: "excellent", details: "مستوى ممتاز في القواعد", needsImprovement: false },
                    { name: "الرياضيات", level: "needs-improvement", details: "تحتاج لتحسين في التكامل", needsImprovement: true, tip: "خصص وقتاً إضافياً لحل مسائل التكامل المعقدة" },
                    { name: "الفيزياء", level: "good", details: "مستوى جيد في البصريات", needsImprovement: false },
                    { name: "الكيمياء", level: "excellent", details: "مستوى ممتاز في الكيمياء التحليلية", needsImprovement: false },
                    { name: "الأحياء", level: "needs-improvement", details: "تحتاج لتحسين في علم البيئة", needsImprovement: true, tip: "ركز على دراسة العلاقات البيئية والسلاسل الغذائية" }
                ],
                "علمي رياضة": [
                    { name: "اللغة العربية", level: "good", details: "مستوى جيد في النصوص", needsImprovement: false },
                    { name: "اللغة الإنجليزية", level: "excellent", details: "مستوى ممتاز في القواعد", needsImprovement: false },
                    { name: "الرياضيات", level: "excellent", details: "مستوى ممتاز في الجبر والهندسة", needsImprovement: false },
                    { name: "الفيزياء", level: "needs-improvement", details: "تحتاج لتحسين في الميكانيكا", needsImprovement: true, tip: "ركز على فهم قوانين نيوتن وحل المسائل المتعلقة بها" },
                    { name: "الكيمياء", level: "good", details: "مستوى جيد في الكيمياء العضوية", needsImprovement: false },
                    { name: "الرياضيات التطبيقية", level: "excellent", details: "مستوى ممتاز في الإحصاء", needsImprovement: false }
                ],
                "أدبي": [
                    { name: "اللغة العربية", level: "excellent", details: "مستوى ممتاز في البلاغة", needsImprovement: false },
                    { name: "اللغة الإنجليزية", level: "good", details: "مستوى جيد في القراءة", needsImprovement: false },
                    { name: "التاريخ", level: "needs-improvement", details: "تحتاج لتحسين في التاريخ المعاصر", needsImprovement: true, tip: "ركز على دراسة الأحداث السياسية والاقتصادية في القرن العشرين" },
                    { name: "الجغرافيا", level: "excellent", details: "مستوى ممتاز في الجغرافيا الاقتصادية", needsImprovement: false },
                    { name: "الفلسفة", level: "good", details: "مستوى جيد في الفلسفة الغربية", needsImprovement: false },
                    { name: "علم النفس", level: "needs-improvement", details: "تحتاج لتحسين في علم النفس الإكلينيكي", needsImprovement: true, tip: "ركز على دراسة نظريات العلاج النفسي والاضطرابات" }
                ]
            }
        };

        // الكتب الدراسية للصف الثاني الثانوي - تم التحديث بالروابط الجديدة
        const studyBooks = {
            "الصف الثاني الثانوي": {
                "علمي": [
                    {
                        name: "اللغة العربية",
                        type: "لغة عربية",
                        logo: "fas fa-book",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Arabic_language_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "قواعد النحو والصرف",
                        type: "لغة عربية",
                        logo: "fas fa-language",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry1/Term1/StudentBook/naho_general_TR1_1sec.pdf",
                        summary: null
                    },
                    {
                        name: "اللغة العربية (قصة)",
                        type: "لغة عربية",
                        logo: "fas fa-book-open",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Arabic_language_Story_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "English Language",
                        type: "لغة إنجليزية",
                        logo: "fas fa-globe",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/English_language_2sec_t1.pdf",
                        summary: null
                    },
                    {
                        name: "الفيزياء (عربي)",
                        type: "فيزياء",
                        logo: "fas fa-atom",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Physics_Arabic_2_Secondary_TR1.pdf",
                        summary: null
                    },
                    {
                        name: "Physics (English)",
                        type: "فيزياء",
                        logo: "fas fa-atom",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Physics_EN_Secondary2_TR1.pdf",
                        summary: null
                    },
                    {
                        name: "الكيمياء (عربي)",
                        type: "كيمياء",
                        logo: "fas fa-flask",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Chemistry_Arabic_2_Secondary_TR1.pdf",
                        summary: null
                    },
                    {
                        name: "Chemistry (English)",
                        type: "كيمياء",
                        logo: "fas fa-flask",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/chemistry_English_Sec2_TR1.pdf",
                        summary: null
                    },
                    {
                        name: "التربية الدينية الإسلامية",
                        type: "تربية دينية",
                        logo: "fas fa-mosque",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Islamic_religion_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "التربية الدينية المسيحية",
                        type: "تربية دينية",
                        logo: "fas fa-church",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Christian_religion_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "رياضيات بحته (علمي)",
                        type: "رياضيات",
                        logo: "fas fa-calculator",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/pure_Mathematics_ARABIC_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "رياضيات تطبيقيه (علمي)",
                        type: "رياضيات",
                        logo: "fas fa-calculator",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Application_Mathematics_AR_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "Pure Maths (علمي)",
                        type: "رياضيات",
                        logo: "fas fa-calculator",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/pure_Mathematics_ENGLISH_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "Application Maths (علمي)",
                        type: "رياضيات",
                        logo: "fas fa-calculator",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Application_Mathematics_EN_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "ألماني",
                        type: "لغة ألمانية",
                        logo: "fas fa-language",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Deutsch_language_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "إسباني",
                        type: "لغة إسبانية",
                        logo: "fas fa-language",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Espa%C3%B1ol_language_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "ايطالي",
                        type: "لغة إيطالية",
                        logo: "fas fa-language",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Italiano_language_Sec2_Tr1.pdf",
                        summary: null
                    }
                ],
                "أدبي": [
                    {
                        name: "اللغة العربية",
                        type: "لغة عربية",
                        logo: "fas fa-book",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Arabic_language_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "قواعد النحو والصرف",
                        type: "لغة عربية",
                        logo: "fas fa-language",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry1/Term1/StudentBook/naho_general_TR1_1sec.pdf",
                        summary: null
                    },
                    {
                        name: "اللغة العربية (قصة)",
                        type: "لغة عربية",
                        logo: "fas fa-book-open",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Arabic_language_Story_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "English Language",
                        type: "لغة إنجليزية",
                        logo: "fas fa-globe",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/English_language_2sec_t1.pdf",
                        summary: null
                    },
                    {
                        name: "التربية الدينية الإسلامية",
                        type: "تربية دينية",
                        logo: "fas fa-mosque",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Islamic_religion_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "التربية الدينية المسيحية",
                        type: "تربية دينية",
                        logo: "fas fa-church",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Christian_religion_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "التاريخ",
                        type: "تاريخ",
                        logo: "fas fa-monument",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/History_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "الجغرافيا (ادبي)",
                        type: "جغرافيا",
                        logo: "fas fa-globe-africa",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Geography_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "رياضيات عامه (ادبي)",
                        type: "رياضيات",
                        logo: "fas fa-calculator",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/General_Mathematics_ARABIC_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "ألماني",
                        type: "لغة ألمانية",
                        logo: "fas fa-language",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Deutsch_language_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "إسباني",
                        type: "لغة إسبانية",
                        logo: "fas fa-language",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Espa%C3%B1ol_language_Sec2_Tr1.pdf",
                        summary: null
                    },
                    {
                        name: "ايطالي",
                        type: "لغة إيطالية",
                        logo: "fas fa-language",
                        textbook: "https://elearnningcontent.blob.core.windows.net/elearnningcontent/2026/Secondry/Secondry2/Term1/StudentBook/Italiano_language_Sec2_Tr1.pdf",
                        summary: null
                    }
                ]
            }
        };

        // الامتحانات للصف الثاني الثانوي
        const examsData = {
            "الصف الثاني الثانوي": {
                "علمي": [
                    {
                        name: "امتحان الرياضيات - الفصل الأول",
                        date: "2024-12-1",
                        duration: "120 دقيقة",
                        questions: 30,
                        status: "متاح"
                    },
                    {
                        name: "امتحان الفيزياء - الفصل الأول",
                        date: "2024-12-1",
                        duration: "90 دقيقة",
                        questions: 25,
                        status: "متاح"
                    },
                    {
                        name: "امتحان الكيمياء - الفصل الأول",
                        date: "2024-12-2",
                        duration: "90 دقيقة",
                        questions: 25,
                        status: "قريب"
                    },
                    {
                        name: "امتحان اللغة العربية - الفصل الأول",
                        date: "2024-12-4",
                        duration: "120 دقيقة",
                        questions: 40,
                        status: "قريب"
                    },
                    {
                        name: "امتحان اللغة الإنجليزية - الفصل الأول",
                        date: "2024-12-05",
                        duration: "90 دقيقة",
                        questions: 35,
                        status: "قريب"
                    }
                ],
                "أدبي": [
                    {
                        name: "امتحان اللغة العربية - الفصل الأول",
                        date: "2024-11-30",
                        duration: "120 دقيقة",
                        questions: 40,
                        status: "انتهي"
                    },
                    {
                        name: "امتحان التاريخ - الفصل الأول",
                        date: "2024-10-20",
                        duration: "90 دقيقة",
                        questions: 30,
                        status: "انتهي"
                    },
                    {
                        name: "امتحان الجغرافيا - الفصل الأول",
                        date: "2024-10-25",
                        duration: "90 دقيقة",
                        questions: 30,
                        status: "انتهي"
                    },
                    {
                        name: "امتحان اللغة الإنجليزية - الفصل الأول",
                        date: "2024-11-01",
                        duration: "90 دقيقة",
                        questions: 35,
                        status: "انتهي"
                    },
                    {
                        name: "امتحان الفلسفة - الفصل الأول",
                        date: "2024-11-05",
                        duration: "90 دقيقة",
                        questions: 25,
                        status: "انتهي"
                    }
                ]
            }
        };

        // Generate unique user ID
        function generateUserId() {
            return 'user_' + Math.random().toString(36).substring(2, 10);
        }

        // Create floating particles
        function createParticles() {
            const colors = ['#3498db', '#2ecc71', '#9b59b6', '#e74c3c', '#f39c12'];
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                const size = Math.random() * 10 + 5;
                const color = colors[Math.floor(Math.random() * colors.length)];
                const left = Math.random() * 100;
                const animationDuration = Math.random() * 20 + 10;
                const animationDelay = Math.random() * 5;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.background = color;
                particle.style.left = `${left}%`;
                particle.style.animationDuration = `${animationDuration}s`;
                particle.style.animationDelay = `${animationDelay}s`;
                
                particlesContainer.appendChild(particle);
            }
        }

        // Show toast message
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Play success sound
        function playSuccessSound() {
            // Create audio context for success sound
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.1;
                
                oscillator.start();
                
                // Create a pleasant success sound
                oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                setTimeout(() => {
                    oscillator.stop();
                }, 300);
            } catch (e) {
                console.log("Audio not supported");
            }
        }

        // Load chat history
        function loadChatHistory() {
            // Load chat history from localStorage
            chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
            
            // Update both chat windows
            updateChatWindows();
        }

        // Update both chat windows with current history
        function updateChatWindows() {
            // Update floating chat window
            if (chatMessages) {
                chatMessages.innerHTML = '';
                chatHistory.forEach(msg => {
                    addMessage(msg.text, msg.sender, chatMessages);
                });
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Update chats page
            if (chatsMessages) {
                chatsMessages.innerHTML = '';
                chatHistory.forEach(msg => {
                    addMessage(msg.text, msg.sender, chatsMessages);
                });
                chatsMessages.scrollTop = chatsMessages.scrollHeight;
            }
        }

        // Add message to chat
        function addMessage(text, sender, container) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'user' ? 'user-message' : 'bot-message'}`;
            messageDiv.textContent = text;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Save message to history
        function saveMessageToHistory(text, sender) {
            chatHistory.push({
                text: text,
                sender: sender,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 100 messages to prevent storage overflow
            if (chatHistory.length > 100) {
                chatHistory = chatHistory.slice(-100);
            }
            
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
            updateChatWindows();
        }

        // دالة لتغيير الحكمة
        function changeWisdom() {
            const randomIndex = Math.floor(Math.random() * wisdomMessages.length);
            const wisdom = wisdomMessages[randomIndex];
            
            if (wisdomText) wisdomText.textContent = `"${wisdom.text}"`;
            if (wisdomAuthor) wisdomAuthor.textContent = `- ${wisdom.author}`;
        }

        // دالة لجدولة تغيير الحكمة عند الساعة 12 صباحاً ومساءً
        function scheduleWisdomChange() {
            const now = new Date();
            const nextNoon = new Date(now);
            nextNoon.setHours(12, 0, 0, 0);
            
            const nextMidnight = new Date(now);
            nextMidnight.setHours(24, 0, 0, 0);
            
            let nextChange;
            if (now.getHours() < 12) {
                nextChange = nextNoon;
            } else if (now.getHours() < 24) {
                nextChange = nextMidnight;
            } else {
                nextChange = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                nextChange.setHours(12, 0, 0, 0);
            }
            
            const timeUntilNextChange = nextChange - now;
            
            // إلغاء المؤقت السابق إذا كان موجوداً
            if (wisdomChangeTimeout) {
                clearTimeout(wisdomChangeTimeout);
            }
            
            wisdomChangeTimeout = setTimeout(() => {
                changeWisdom();
                scheduleWisdomChange(); // جدولة التغيير التالي
            }, timeUntilNextChange);
        }

        // Load study books based on grade and branch
        function loadStudyBooks(grade, branch, subject = null) {
            if (!booksGrid) return;
            
            booksGrid.innerHTML = '';
            
            if (studyBooks[grade] && studyBooks[grade][branch]) {
                let books = studyBooks[grade][branch];
                
                // إذا تم تحديد مادة، قم بتصفية الكتب حسب المادة
                if (subject) {
                    books = books.filter(book => book.name.includes(subject) || book.type.includes(subject));
                }
                
                books.forEach(book => {
                    const bookCard = document.createElement('div');
                    bookCard.className = 'book-card';
                    
                    bookCard.innerHTML = `
                        <div class="book-header">
                            <div class="book-logo">
                                <i class="${book.logo}"></i>
                            </div>
                            <div class="book-info">
                                <div class="book-name">${book.name}</div>
                                <div class="book-type">${book.type}</div>
                            </div>
                        </div>
                        <div class="book-actions">
                            <button class="book-btn textbook-btn" ${book.textbook ? '' : 'disabled'}>
                                <i class="fas fa-book"></i>
                                كتاب مدرسي
                            </button>
                            <button class="book-btn summary-btn" ${book.summary ? '' : 'disabled'}>
                                <i class="fas fa-file-alt"></i>
                                ملخص
                            </button>
                        </div>
                    `;
                    
                    // Add event listeners for buttons
                    const textbookBtn = bookCard.querySelector('.textbook-btn');
                    const summaryBtn = bookCard.querySelector('.summary-btn');
                    
                    if (book.textbook) {
                        textbookBtn.addEventListener('click', () => {
                            window.open(book.textbook, '_blank');
                        });
                    }
                    
                    if (book.summary) {
                        summaryBtn.addEventListener('click', () => {
                            window.open(book.summary, '_blank');
                        });
                    }
                    
                    booksGrid.appendChild(bookCard);
                });
            } else {
                booksGrid.innerHTML = '<p>لا توجد كتب دراسية مسجلة لهذا الصف والشعبة.</p>';
            }
        }

        // Load exams based on grade and branch
        function loadExams(grade, branch) {
            if (!examsGrid) return;
            
            examsGrid.innerHTML = '';
            
            if (examsData[grade] && examsData[grade][branch]) {
                const exams = examsData[grade][branch];
                
                exams.forEach(exam => {
                    const examCard = document.createElement('div');
                    examCard.className = 'exam-card';
                    
                    examCard.innerHTML = `
                        <div class="exam-header">
                            <div class="exam-name">${exam.name}</div>
                            <div class="exam-date">${exam.date}</div>
                        </div>
                        <div class="exam-details">
                            <p>المدة: ${exam.duration}</p>
                            <p>عدد الأسئلة: ${exam.questions}</p>
                            <p>الحالة: <span class="${exam.status === 'متاح' ? 'level-excellent' : 'level-good'}">${exam.status}</span></p>
                        </div>
                        <div class="exam-actions">
                            <button class="exam-btn start-exam-btn" ${exam.status === 'متاح' ? '' : 'disabled'}>
                                <i class="fas fa-play"></i>
                                بدء الامتحان
                            </button>
                            <button class="exam-btn review-exam-btn">
                                <i class="fas fa-eye"></i>
                                مراجعة النتائج
                            </button>
                        </div>
                    `;
                    
                    // Add event listeners for buttons
                    const startExamBtn = examCard.querySelector('.start-exam-btn');
                    const reviewExamBtn = examCard.querySelector('.review-exam-btn');
                    
                    if (exam.status === 'متاح') {
                        startExamBtn.addEventListener('click', () => {
                            showToast(currentLanguage === 'ar' ? 'جاري تحميل الامتحان...' : 'Loading exam...');
                            // في التطبيق الحقيقي، سيتم هنا تحميل الامتحان
                        });
                    }
                    
                    reviewExamBtn.addEventListener('click', () => {
                        showToast(currentLanguage === 'ar' ? 'جاري تحميل النتائج...' : 'Loading results...');
                        // في التطبيق الحقيقي، سيتم هنا تحميل النتائج
                    });
                    
                    examsGrid.appendChild(examCard);
                });
            } else {
                examsGrid.innerHTML = '<p>لا توجد امتحانات مسجلة لهذا الصف والشعبة.</p>';
            }
        }

        // Initialize App
        function initApp() {
            // Scroll to top when page loads
            window.scrollTo(0, 0);
            
            // Create particles
            createParticles();
            
            // Check if user is logged in from localStorage
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const savedUsername = localStorage.getItem('username');
            const savedRememberMe = localStorage.getItem('rememberMe') === 'true';
            
            if (isLoggedIn && savedUsername) {
                // User is already logged in, hide login modal
                loginModal.classList.remove('active');
                
                // Update menu user name
                menuUserName.textContent = savedUsername;
                
                // Hide loading screen after a delay
                setTimeout(() => {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }, 1500);
                
                // Auto-fill login form if remember me is checked
                if (savedRememberMe) {
                    document.getElementById('username').value = savedUsername;
                    rememberMe.checked = true;
                }
            } else {
                // Show login modal
                loginModal.classList.add('active');
            }

            // Apply saved settings
            applySettings();
            
            // Load chat history
            loadChatHistory();
            
            // تهيئة الحكمة التشجيعية
            changeWisdom();
            scheduleWisdomChange();
            
            // Set up event listeners
            setupEventListeners();
        }

        // Apply saved settings
        function applySettings() {
            // Dark mode
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                if (darkModeToggle) darkModeToggle.checked = true;
                if (modeToggle) modeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                if (modeToggle) modeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }

            // Language
            if (languageSelect) languageSelect.value = currentLanguage;
            updateLanguage();

            // Font size
            if (fontSizeSlider) fontSizeSlider.value = currentFontSize;
            if (fontSizeValue) fontSizeValue.textContent = `${currentFontSize}px`;
            document.body.style.fontSize = `${currentFontSize}px`;

            // Notifications
            if (reminderNotifications) reminderNotifications.checked = localStorage.getItem('reminderNotifications') === 'true';

            // Update user info
            const savedName = localStorage.getItem('userName');
            if (savedName) {
                if (profileName) profileName.textContent = savedName;
                if (menuUserName) menuUserName.textContent = savedName;
                if (nameInput) nameInput.value = savedName;
            }

            const savedEmail = localStorage.getItem('userEmail');
            if (savedEmail) {
                if (profileEmail) profileEmail.textContent = savedEmail;
                if (emailInput) emailInput.value = savedEmail;
            }

            // Update phone
            const savedPhone = localStorage.getItem('userPhone');
            if (savedPhone && phoneInput) {
                phoneInput.value = savedPhone;
            }

            // Load profile image
            const savedProfileImage = localStorage.getItem('profileImage');
            if (savedProfileImage) {
                if (profileImage) profileImage.innerHTML = `<img src="${savedProfileImage}" alt="Profile Image">`;
                if (menuUserAvatar) menuUserAvatar.innerHTML = `<img src="${savedProfileImage}" alt="Profile Image">`;
            }

            // Load grade and branch
            const savedGrade = localStorage.getItem('userGrade');
            if (savedGrade) {
                if (gradeInput) gradeInput.value = savedGrade;
                if (studyLevel) studyLevel.textContent = `الصف: ${savedGrade}`;
                if (studyLevelMaterials) studyLevelMaterials.textContent = `الصف: ${savedGrade}`;
                if (booksCategory) booksCategory.textContent = `الصف: ${savedGrade}`;
                if (examsCategory) examsCategory.textContent = `الصف: ${savedGrade}`;
                
                // Show/hide branch field based on grade
                toggleBranchField(savedGrade);
            }

            const savedBranch = localStorage.getItem('userBranch');
            if (savedBranch) {
                if (branchInput) branchInput.value = savedBranch;
                if (studyBranch) studyBranch.textContent = `الشعبة: ${savedBranch}`;
                if (studyBranchMaterials) studyBranchMaterials.textContent = `الشعبة: ${savedBranch}`;
                if (booksBranch) booksBranch.textContent = `الشعبة: ${savedBranch}`;
                if (examsBranch) examsBranch.textContent = `الشعبة: ${savedBranch}`;
                
                // Load study materials if grade and branch are set
                if (savedGrade && savedBranch) {
                    loadStudyMaterials(savedGrade, savedBranch);
                    loadStudyBooks(savedGrade, savedBranch);
                    loadExams(savedGrade, savedBranch);
                }
            }

            // Get or create user ID
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = generateUserId();
                localStorage.setItem('userId', userId);
            }
            if (profileUserId) profileUserId.textContent = userId;

            // Initialize currentUser
            currentUser = {
                user_id: userId,
                name: localStorage.getItem('userName') || 'زائر',
                email: localStorage.getItem('userEmail') || '',
                phone: localStorage.getItem('userPhone') || '',
                grade: savedGrade || '',
                branch: savedBranch || ''
            };
        }

        // Toggle branch field based on grade
        function toggleBranchField(grade) {
            if (!branchGroup) return;
            
            // Show branch field only for second and third secondary grades
            if (grade === "الصف الثاني الثانوي" || grade === "الصف الثالث الثانوي") {
                branchGroup.style.display = 'flex';
            } else {
                branchGroup.style.display = 'none';
                if (branchInput) branchInput.value = '';
                if (studyBranch) studyBranch.textContent = `الشعبة: غير محددة`;
                if (studyBranchMaterials) studyBranchMaterials.textContent = `الشعبة: غير محددة`;
                if (booksBranch) booksBranch.textContent = `الشعبة: غير محددة`;
                if (examsBranch) examsBranch.textContent = `الشعبة: غير محددة`;
            }
        }

        // Load study materials based on grade and branch (للتحليلات)
        function loadStudyMaterials(grade, branch) {
            if (!materialsGrid) return;
            
            materialsGrid.innerHTML = '';
            
            if (studyMaterials[grade] && studyMaterials[grade][branch]) {
                const materials = studyMaterials[grade][branch];
                
                materials.forEach(material => {
                    const materialCard = document.createElement('div');
                    materialCard.className = 'material-card';
                    
                    let levelClass = '';
                    let levelText = '';
                    
                    switch(material.level) {
                        case 'excellent':
                            levelClass = 'level-excellent';
                            levelText = 'ممتاز';
                            break;
                        case 'good':
                            levelClass = 'level-good';
                            levelText = 'جيد';
                            break;
                        case 'needs-improvement':
                            levelClass = 'level-needs-improvement';
                            levelText = 'يحتاج تحسين';
                            break;
                    }
                    
                    materialCard.innerHTML = `
                        <div class="material-header">
                            <div class="material-name">${material.name}</div>
                            <div class="material-level ${levelClass}">${levelText}</div>
                        </div>
                        <div class="material-details">${material.details}</div>
                        ${material.needsImprovement ? `<div class="improvement-tip">${material.tip}</div>` : ''}
                    `;
                    
                    materialsGrid.appendChild(materialCard);
                });
            } else {
                materialsGrid.innerHTML = '<p>لا توجد مواد دراسية مسجلة لهذا الصف والشعبة.</p>';
            }
        }

        // Load materials list for study-materials page
        function loadMaterialsList(grade, branch) {
            if (!materialsListGrid) return;
            
            materialsListGrid.innerHTML = '';
            
            if (studyMaterials[grade] && studyMaterials[grade][branch]) {
                const materials = studyMaterials[grade][branch];
                
                materials.forEach(material => {
                    const materialCard = document.createElement('div');
                    materialCard.className = 'material-card';
                    materialCard.setAttribute('data-subject', material.name);
                    
                    materialCard.innerHTML = `
                        <div class="material-header">
                            <div class="material-name">${material.name}</div>
                        </div>
                        <div class="material-details">انقر لفتح مكتبة الكتب الخاصة بهذه المادة</div>
                    `;
                    
                    // Add click event to open books library for this subject
                    materialCard.addEventListener('click', () => {
                        selectedSubject = material.name;
                        switchPage('study-books');
                        loadStudyBooks(grade, branch, material.name);
                    });
                    
                    materialsListGrid.appendChild(materialCard);
                });
            } else {
                materialsListGrid.innerHTML = '<p>لا توجد مواد دراسية مسجلة لهذا الصف والشعبة.</p>';
            }
        }

        // Update language
        function updateLanguage() {
            const lang = currentLanguage;
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            
            // Update all elements with data-key attribute
            const elements = document.querySelectorAll('[data-key]');
            elements.forEach(element => {
                const key = element.getAttribute('data-key');
                if (translations[lang] && translations[lang][key]) {
                    if (element.tagName === 'INPUT' && element.type !== 'submit') {
                        element.placeholder = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
        }

        // Translation dictionary
        const translations = {
            ar: {
                // Login
                login: "تسجيل الدخول",
                username: "اسم المستخدم",
                password: "كلمة المرور",
                
                // Menu
                menu: "القائمة",
                home: "الرئيسية",
                analytics: "التحليلات",
                schedule: "الجدول",
                profile: "البروفايل",
                settings: "الإعدادات",
                help: "المساعدة",
                feedback: "إرسال ملاحظات",
                logout: "تسجيل الخروج",
                student: "طالب",
                chats: "المحادثات",
                newChat: "محادثة جديدة",
                
                // Home page
                welcome: "مرحباً بك في StudyMate",
                smartCompanion: "رفيق دراستك الذكي",
                studyMaterials: "مواد دراسية",
                studyMaterialsDesc: "تنظيم المواد الدراسية وملاحظاتك في مكان واحد",
                tasks: "مهام ومواعيد",
                tasksDesc: "تتبع المهام والمواعيد الهامة بسهولة",
                progress: "تتبع التقدم",
                progressDesc: "راقب تقدمك الدراسي مع تقارير مفصلة",
                smartAssistant: "مساعد ذكي",
                smartAssistantDesc: "احصل على إجابات لأسئلتك من مساعدنا الذكي",
                
                // Analytics page
                studyHours: "ساعات الدراسة",
                studyHoursValue: "15 ساعة هذا الأسبوع",
                completedTasks: "المهام المكتملة",
                completedTasksValue: "12 من 18 مهمة مكتملة",
                achievements: "الإنجازات",
                achievementsValue: "5 إنجازات حصلت عليها",
                timeDistribution: "توزيع الوقت",
                timeDistributionValue: "رياضيات: 40%، علوم: 30%، لغة: 30%",
                
                // Schedule page
                monday: "الاثنين",
                mondaySchedule: "رياضيات: 9-11 ص<br>علوم: 2-4 م",
                tuesday: "الثلاثاء",
                tuesdaySchedule: "لغة عربية: 10-12 ص<br>تاريخ: 3-5 م",
                wednesday: "الأربعاء",
                wednesdaySchedule: "رياضيات: 9-11 ص<br>فيزياء: 1-3 م",
                thursday: "الخميس",
                thursdaySchedule: "كيمياء: 10-12 ص<br>أحياء: 2-4 م",
                
                // Profile page
                name: "الاسم",
                email: "البريد الإلكتروني",
                phone: "رقم الهاتف",
                save: "حفظ التغييرات",
                
                // Settings page
                language: "اللغة",
                appearance: "المظهر",
                notifications: "الإشعارات",
                appLanguage: "لغة التطبيق",
                darkMode: "الوضع الليلي",
                fontSize: "حجم الخط",
                reminderNotifications: "إشعارات التذكير",
                
                // Chat
                assistant: "مساعد StudyMate",
                welcomeMessage: "مرحباً! أنا مساعدك الدراسي. كيف يمكنني مساعدتك اليوم؟",
                chatPlaceholder: "اكتب رسالتك هنا..."
            },
            en: {
                // Login
                login: "Login",
                username: "Username",
                password: "Password",
                
                // Menu
                menu: "Menu",
                home: "Home",
                analytics: "Analytics",
                schedule: "Schedule",
                profile: "Profile",
                settings: "Settings",
                help: "Help",
                feedback: "Send Feedback",
                logout: "Logout",
                student: "Student",
                chats: "Chats",
                newChat: "New Chat",
                
                // Home page
                welcome: "Welcome to StudyMate",
                smartCompanion: "Your Smart Study Companion",
                studyMaterials: "Study Materials",
                studyMaterialsDesc: "Organize your study materials and notes in one place",
                tasks: "Tasks & Appointments",
                tasksDesc: "Easily track important tasks and deadlines",
                progress: "Progress Tracking",
                progressDesc: "Monitor your academic progress with detailed reports",
                smartAssistant: "Smart Assistant",
                smartAssistantDesc: "Get answers to your questions from our smart assistant",
                
                // Analytics page
                studyHours: "Study Hours",
                studyHoursValue: "15 hours this week",
                completedTasks: "Completed Tasks",
                completedTasksValue: "12 out of 18 tasks completed",
                achievements: "Achievements",
                achievementsValue: "5 achievements earned",
                timeDistribution: "Time Distribution",
                timeDistributionValue: "Math: 40%, Science: 30%, Language: 30%",
                
                // Schedule page
                monday: "Monday",
                mondaySchedule: "Math: 9-11 AM<br>Science: 2-4 PM",
                tuesday: "Tuesday",
                tuesdaySchedule: "Arabic: 10-12 PM<br>History: 3-5 PM",
                wednesday: "Wednesday",
                wednesdaySchedule: "Math: 9-11 AM<br>Physics: 1-3 PM",
                thursday: "Thursday",
                thursdaySchedule: "Chemistry: 10-12 PM<br>Biology: 2-4 PM",
                
                // Profile page
                name: "Name",
                email: "Email",
                phone: "Phone",
                save: "Save Changes",
                
                // Settings page
                language: "Language",
                appearance: "Appearance",
                notifications: "Notifications",
                appLanguage: "App Language",
                darkMode: "Dark Mode",
                fontSize: "Font Size",
                reminderNotifications: "Reminder Notifications",
                
                // Chat
                assistant: "StudyMate Assistant",
                welcomeMessage: "Hello! I'm your study assistant. How can I help you today?",
                chatPlaceholder: "Type your message here..."
            },
            fr: {
                // Login
                login: "Connexion",
                username: "Nom d'utilisateur",
                password: "Mot de passe",
                
                // Menu
                menu: "Menu",
                home: "Accueil",
                analytics: "Analytiques",
                schedule: "Emploi du temps",
                profile: "Profil",
                settings: "Paramètres",
                help: "Aide",
                feedback: "Envoyer des commentaires",
                logout: "Déconnexion",
                student: "Étudiant",
                chats: "Chats",
                newChat: "Nouveau Chat",
                
                // Home page
                welcome: "Bienvenue dans StudyMate",
                smartCompanion: "Votre compagnon d'étude intelligent",
                studyMaterials: "Matériel d'étude",
                studyMaterialsDesc: "Organisez vos supports d'étude et vos notes en un seul endroit",
                tasks: "Tâches et rendez-vous",
                tasksDesc: "Suivez facilement les tâches et les délais importants",
                progress: "Suivi des progrès",
                progressDesc: "Surveillez vos progrès académiques avec des rapports détaillés",
                smartAssistant: "Assistant intelligent",
                smartAssistantDesc: "Obtenez des réponses à vos questions de notre assistant intelligent",
                
                // Analytics page
                studyHours: "Heures d'étude",
                studyHoursValue: "15 heures cette semaine",
                completedTasks: "Tâches terminées",
                completedTasksValue: "12 tâches sur 18 terminées",
                achievements: "Réalisations",
                achievementsValue: "5 réalisations obtenues",
                timeDistribution: "Répartition du temps",
                timeDistributionValue: "Maths: 40%, Sciences: 30%, Langue: 30%",
                
                // Schedule page
                monday: "Lundi",
                mondaySchedule: "Maths: 9h-11h<br>Sciences: 14h-16h",
                tuesday: "Mardi",
                tuesdaySchedule: "Arabe: 10h-12h<br>Histoire: 15h-17h",
                wednesday: "Mercredi",
                wednesdaySchedule: "Maths: 9h-11h<br>Physique: 13h-15h",
                thursday: "Jeudi",
                thursdaySchedule: "Chimie: 10h-12h<br>Biologie: 14h-16h",
                
                // Profile page
                name: "Nom",
                email: "E-mail",
                phone: "Téléphone",
                save: "Enregistrer les modifications",
                
                // Settings page
                language: "Langue",
                appearance: "Apparence",
                notifications: "Notifications",
                appLanguage: "Langue de l'application",
                darkMode: "Mode sombre",
                fontSize: "Taille de police",
                reminderNotifications: "Notifications de rappel",
                
                // Chat
                assistant: "Assistant StudyMate",
                welcomeMessage: "Bonjour! Je suis votre assistant d'étude. Comment puis-je vous aider aujourd'hui?",
                chatPlaceholder: "Tapez votre message ici..."
            },
            es: {
                // Login
                login: "Iniciar sesión",
                username: "Nombre de usuario",
                password: "Contraseña",
                
                // Menu
                menu: "Menú",
                home: "Inicio",
                analytics: "Analíticas",
                schedule: "Horario",
                profile: "Perfil",
                settings: "Configuración",
                help: "Ayuda",
                feedback: "Enviar comentarios",
                logout: "Cerrar sesión",
                student: "Estudiante",
                chats: "Chats",
                newChat: "Nuevo Chat",
                
                // Home page
                welcome: "Bienvenido a StudyMate",
                smartCompanion: "Tu compañero de estudio inteligente",
                studyMaterials: "Materiales de estudio",
                studyMaterialsDesc: "Organiza tus materiales de estudio y notas en un solo lugar",
                tasks: "Tareas y citas",
                tasksDesc: "Realiza un seguimiento de tareas y plazos importantes fácilmente",
                progress: "Seguimiento del progreso",
                progressDesc: "Controla tu progreso académico con informes detallados",
                smartAssistant: "Asistente inteligente",
                smartAssistantDesc: "Obtén respuestas a tus preguntas de nuestro asistente inteligente",
                
                // Analytics page
                studyHours: "Horas de estudio",
                studyHoursValue: "15 horas esta semana",
                completedTasks: "Tareas completadas",
                completedTasksValue: "12 de 18 tareas completadas",
                achievements: "Logros",
                achievementsValue: "5 logros obtenidos",
                timeDistribution: "Distribución del tiempo",
                timeDistributionValue: "Matemáticas: 40%, Ciencias: 30%, Lenguaje: 30%",
                
                // Schedule page
                monday: "Lunes",
                mondaySchedule: "Matemáticas: 9-11 AM<br>Ciencias: 2-4 PM",
                tuesday: "Martes",
                tuesdaySchedule: "Árabe: 10-12 PM<br>Historia: 3-5 PM",
                wednesday: "Miércoles",
                wednesdaySchedule: "Matemáticas: 9-11 AM<br>Física: 1-3 PM",
                thursday: "Jueves",
                thursdaySchedule: "Química: 10-12 PM<br>Biología: 2-4 PM",
                
                // Profile page
                name: "Nombre",
                email: "Correo electrónico",
                phone: "Teléfono",
                save: "Guardar cambios",
                
                // Settings page
                language: "Idioma",
                appearance: "Apariencia",
                notifications: "Notificaciones",
                appLanguage: "Idioma de la aplicación",
                darkMode: "Modo oscuro",
                fontSize: "Tamaño de fuente",
                reminderNotifications: "Notificaciones de recordatorio",
                
                // Chat
                assistant: "Asistente StudyMate",
                welcomeMessage: "¡Hola! Soy tu asistente de estudio. ¿Cómo puedo ayudarte hoy?",
                chatPlaceholder: "Escribe tu mensaje aquí..."
            }
        };

        // Set up event listeners
        function setupEventListeners() {
            // Login form
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }

            // Mode toggle
            if (modeToggle) {
                modeToggle.addEventListener('click', toggleDarkMode);
            }

            // Menu toggle
            if (menuToggle) {
                menuToggle.addEventListener('click', openMenu);
            }
            if (closeMenu) {
                closeMenu.addEventListener('click', closeMenuPanel);
            }
            if (menuOverlay) {
                menuOverlay.addEventListener('click', closeMenuPanel);
            }

            // Menu links
            menuLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('data-page');
                    switchPage(pageId);
                    closeMenuPanel();
                    
                    // Update profile form when switching to profile page
                    if (pageId === 'profile') {
                        updateProfileForm();
                    }
                    
                    // Load study materials when switching to analytics page
                    if (pageId === 'analytics') {
                        const grade = localStorage.getItem('userGrade');
                        const branch = localStorage.getItem('userBranch');
                        if (grade && branch) {
                            loadStudyMaterials(grade, branch);
                        }
                    }
                    
                    // Load materials list when switching to study materials page
                    if (pageId === 'study-materials') {
                        const grade = localStorage.getItem('userGrade');
                        const branch = localStorage.getItem('userBranch');
                        if (grade && branch) {
                            loadMaterialsList(grade, branch);
                        }
                    }
                    
                    // Load study books when switching to study books page
                    if (pageId === 'study-books') {
                        const grade = localStorage.getItem('userGrade');
                        const branch = localStorage.getItem('userBranch');
                        if (grade && branch) {
                            // إذا كانت هناك مادة محددة، قم بتحميل الكتب الخاصة بها
                            if (selectedSubject) {
                                loadStudyBooks(grade, branch, selectedSubject);
                            } else {
                                loadStudyBooks(grade, branch);
                            }
                        }
                    }
                    
                    // Load exams when switching to exams page
                    if (pageId === 'exams') {
                        const grade = localStorage.getItem('userGrade');
                        const branch = localStorage.getItem('userBranch');
                        if (grade && branch) {
                            loadExams(grade, branch);
                        }
                    }
                    
                    // Load chat history when switching to chats page
                    if (pageId === 'chats') {
                        loadChatHistory();
                    }
                });
            });

            // Logo click to go to home page
            if (logo) {
                logo.addEventListener('click', () => {
                    switchPage('home');
                });
            }

            // Grade change event
            if (gradeInput) {
                gradeInput.addEventListener('change', (e) => {
                    toggleBranchField(e.target.value);
                });
            }

            // Feature cards
            featureCards.forEach(card => {
                card.addEventListener('click', () => {
                    const action = card.getAttribute('data-action');
                    handleFeatureCardClick(action);
                });
            });

            // Menu actions
            if (helpBtn) helpBtn.addEventListener('click', showHelp);
            if (feedbackBtn) feedbackBtn.addEventListener('click', sendFeedback);
            if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);

            // Chat
            if (chatIcon) chatIcon.addEventListener('click', toggleChat);
            if (closeChat) closeChat.addEventListener('click', closeChatWindow);
            if (sendMessage) sendMessage.addEventListener('click', sendChatMessage);
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
            }

            // Chats page
            if (sendChatsMessage) sendChatsMessage.addEventListener('click', sendChatsMessageHandler);
            if (chatsInput) {
                chatsInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendChatsMessageHandler();
                    }
                });
            }

            // زر المحادثة الجديد في صفحة المحادثات
            if (chatsNewChatBtn) chatsNewChatBtn.addEventListener('click', startNewChat);

            // Settings
            if (languageSelect) languageSelect.addEventListener('change', handleLanguageChange);
            if (darkModeToggle) darkModeToggle.addEventListener('change', handleDarkModeToggle);
            if (fontSizeSlider) fontSizeSlider.addEventListener('input', handleFontSizeChange);
            
            // Notification toggles
            if (reminderNotifications) {
                reminderNotifications.addEventListener('change', () => {
                    localStorage.setItem('reminderNotifications', reminderNotifications.checked);
                });
            }

            // Profile form
            if (profileForm) profileForm.addEventListener('submit', handleProfileUpdate);

            // Profile image
            if (profileImageEdit) {
                profileImageEdit.addEventListener('click', () => {
                    if (profileImageInput) profileImageInput.click();
                });
            }

            if (profileImageInput) {
                profileImageInput.addEventListener('change', handleProfileImageUpload);
            }

            // Save settings button
            if (saveSettingsBtn) saveSettingsBtn.addEventListener('click', saveSettings);
        }

        // Handle feature card clicks
        function handleFeatureCardClick(action) {
            switch(action) {
                case 'chats':
                    switchPage('chats');
                    loadChatHistory();
                    break;
                case 'schedule':
                    switchPage('schedule');
                    break;
                case 'analytics':
                    switchPage('analytics');
                    break;
                case 'study-materials':
                    switchPage('study-materials');
                    const grade = localStorage.getItem('userGrade');
                    const branch = localStorage.getItem('userBranch');
                    if (grade && branch) {
                        loadMaterialsList(grade, branch);
                    }
                    break;
                case 'study-books':
                    switchPage('study-books');
                    const gradeBooks = localStorage.getItem('userGrade');
                    const branchBooks = localStorage.getItem('userBranch');
                    if (gradeBooks && branchBooks) {
                        loadStudyBooks(gradeBooks, branchBooks);
                    }
                    break;
                case 'exams':
                    switchPage('exams');
                    const gradeExams = localStorage.getItem('userGrade');
                    const branchExams = localStorage.getItem('userBranch');
                    if (gradeExams && branchExams) {
                        loadExams(gradeExams, branchExams);
                    }
                    break;
                case 'profile':
                    switchPage('profile');
                    break;
                default:
                    console.log('Unknown action:', action);
            }
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const rememberMeChecked = rememberMe.checked;

            // Simple validation
            if (username && password) {
                // Save login state and user info
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('username', username);
                localStorage.setItem('rememberMe', rememberMeChecked);
                
                // Generate user ID if doesn't exist
                if (!localStorage.getItem('userId')) {
                    localStorage.setItem('userId', generateUserId());
                }
                
                // Save default user info if not exists
                if (!localStorage.getItem('userName')) {
                    localStorage.setItem('userName', username);
                }
                if (!localStorage.getItem('userEmail')) {
                    localStorage.setItem('userEmail', `${username}@studymate.com`);
                }
                
                // Update menu user name
                if (menuUserName) menuUserName.textContent = username;
                
                // Hide login modal
                loginModal.classList.remove('active');
                
                // Show loading screen
                if (loadingScreen) {
                    loadingScreen.style.display = 'flex';
                    loadingScreen.style.opacity = '1';
                    
                    // Hide loading screen after delay
                    setTimeout(() => {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                        }, 500);
                    }, 1500);
                }
                
                // Update currentUser
                currentUser = {
                    user_id: localStorage.getItem('userId'),
                    name: localStorage.getItem('userName') || username,
                    email: localStorage.getItem('userEmail') || `${username}@studymate.com`,
                    phone: localStorage.getItem('userPhone') || '',
                    grade: localStorage.getItem('userGrade') || '',
                    branch: localStorage.getItem('userBranch') || ''
                };
                
                // Update profile form after login
                updateProfileForm();
                
                showToast(currentLanguage === 'ar' ? 'تم تسجيل الدخول بنجاح' : 'Logged in successfully');
                playSuccessSound();
            } else {
                showToast(currentLanguage === 'ar' ? 'يرجى ملء جميع الحقول' : 'Please fill all fields');
            }
        }

        // Show help
        function showHelp() {
            alert(currentLanguage === 'ar' 
                ? 'للمساعدة، يرجى التواصل مع فريق الدعم عبر البريد الإلكتروني: support@studymate.com'
                : 'For help, please contact our support team via email: support@studymate.com');
            closeMenuPanel();
        }

        // Send feedback
        function sendFeedback() {
            alert(currentLanguage === 'ar' 
                ? 'شكراً لك على ملاحظاتك! سنقوم بمراجعتها وتحسين التطبيق بناءً عليها.'
                : 'Thank you for your feedback! We will review it and improve the application accordingly.');
            closeMenuPanel();
        }

        // Handle logout
        function handleLogout() {
            if (confirm(currentLanguage === 'ar' 
                ? 'هل أنت متأكد من تسجيل الخروج؟'
                : 'Are you sure you want to logout?')) {
                // Clear login state
                localStorage.setItem('isLoggedIn', 'false');
                
                // Show login modal
                loginModal.classList.add('active');
                
                // Reset menu user name
                if (menuUserName) menuUserName.textContent = 'زائر';
                
                // Show toast message
                showToast(currentLanguage === 'ar' ? 'تم تسجيل الخروج بنجاح' : 'Logged out successfully');
            }
            closeMenuPanel();
        }

        // Toggle dark mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            
            if (isDarkMode) {
                if (modeToggle) modeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                if (modeToggle) modeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // Open menu
        function openMenu() {
            if (menuOverlay) menuOverlay.classList.add('active');
            if (menuPanel) menuPanel.classList.add('active');
        }

        // Close menu panel
        function closeMenuPanel() {
            if (menuOverlay) menuOverlay.classList.remove('active');
            if (menuPanel) menuPanel.classList.remove('active');
        }

        // Switch page
        function switchPage(pageId) {
            // Hide all pages
            pages.forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all menu links
            menuLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            // Show selected page
            const selectedPage = document.getElementById(pageId);
            if (selectedPage) {
                selectedPage.classList.add('active');
                
                // Add active class to corresponding menu link
                const activeLink = document.querySelector(`[data-page="${pageId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
                
                // Scroll to top when switching pages
                window.scrollTo(0, 0);
            }
        }

        // Toggle chat window
        function toggleChat() {
            if (chatWindow) chatWindow.classList.toggle('active');
        }

        // Close chat window
        function closeChatWindow() {
            if (chatWindow) chatWindow.classList.remove('active');
        }

        // Send chat message to webhook
        async function sendChatMessage() {
            const message = chatInput.value.trim();
            if (message) {
                // Add user message
                addMessage(message, 'user', chatMessages);
                
                // Save to history
                saveMessageToHistory(message, 'user');
                
                // Clear input
                if (chatInput) chatInput.value = '';
                
                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'message loading-message';
                loadingDiv.textContent = currentLanguage === 'ar' ? 'جاري التفكير...' : 'Thinking...';
                if (chatMessages) chatMessages.appendChild(loadingDiv);
                if (chatMessages) chatMessages.scrollTop = chatMessages.scrollHeight;
                
                try {
                    // Send message to webhook
                    const response = await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            user_id: currentUser?.user_id || 'guest',
                            name: currentUser?.name || 'زائر',
                            email: currentUser?.email || '',
                            grade: currentUser?.grade || '',
                            branch: currentUser?.branch || '',
                            timestamp: new Date().toISOString()
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    
                    const reply = await response.text(); // الرد من n8n
                    
                    // Remove loading message
                    loadingDiv.remove();
                    
                    // Add bot response from n8n
                    addMessage(reply, 'bot', chatMessages);
                    
                    // Save bot response to history
                    saveMessageToHistory(reply, 'bot');
                    
                } catch (error) {
                    console.error('Error sending message to webhook:', error);
                    
                    // Remove loading message
                    loadingDiv.remove();
                    
                    // Add error message
                    const errorMessage = currentLanguage === 'ar' 
                        ? 'عذراً، حدث خطأ في الاتصال. يرجى المحاولة مرة أخرى.'
                        : 'Sorry, there was an error connecting. Please try again.';
                    
                    addMessage(errorMessage, 'bot', chatMessages);
                    
                    // Save error message to history
                    saveMessageToHistory(errorMessage, 'bot');
                }
            }
        }

        // Send message in chats page
        async function sendChatsMessageHandler() {
            const message = chatsInput.value.trim();
            if (message) {
                // Add user message
                addMessage(message, 'user', chatsMessages);
                
                // Save to history
                saveMessageToHistory(message, 'user');
                
                // Clear input
                if (chatsInput) chatsInput.value = '';
                
                // Show loading message
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'message loading-message';
                loadingDiv.textContent = currentLanguage === 'ar' ? 'جاري التفكير...' : 'Thinking...';
                if (chatsMessages) chatsMessages.appendChild(loadingDiv);
                if (chatsMessages) chatsMessages.scrollTop = chatsMessages.scrollHeight;
                
                try {
                    // Send message to webhook
                    const response = await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            message: message,
                            user_id: currentUser?.user_id || 'guest',
                            name: currentUser?.name || 'زائر',
                            email: currentUser?.email || '',
                            grade: currentUser?.grade || '',
                            branch: currentUser?.branch || '',
                            timestamp: new Date().toISOString()
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    
                    const reply = await response.text(); // الرد من n8n
                    
                    // Remove loading message
                    loadingDiv.remove();
                    
                    // Add bot response from n8n
                    addMessage(reply, 'bot', chatsMessages);
                    
                    // Save bot response to history
                    saveMessageToHistory(reply, 'bot');
                    
                } catch (error) {
                    console.error('Error sending message to webhook:', error);
                    
                    // Remove loading message
                    loadingDiv.remove();
                    
                    // Add error message
                    const errorMessage = currentLanguage === 'ar' 
                        ? 'عذراً، حدث خطأ في الاتصال. يرجى المحاولة مرة أخرى.'
                        : 'Sorry, there was an error connecting. Please try again.';
                    
                    addMessage(errorMessage, 'bot', chatsMessages);
                    
                    // Save error message to history
                    saveMessageToHistory(errorMessage, 'bot');
                }
            }
        }

        // Start new chat
        function startNewChat() {
            chatHistory = [];
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
            updateChatWindows();
            showToast(currentLanguage === 'ar' ? 'بدأت محادثة جديدة' : 'Started a new chat');
        }

        // Handle language change
        function handleLanguageChange() {
            currentLanguage = languageSelect.value;
            localStorage.setItem('language', currentLanguage);
            updateLanguage();
            showToast(currentLanguage === 'ar' ? 'تم تغيير اللغة' : 'Language changed');
        }

        // Handle dark mode toggle
        function handleDarkModeToggle() {
            isDarkMode = darkModeToggle.checked;
            document.body.classList.toggle('dark-mode', isDarkMode);
            localStorage.setItem('darkMode', isDarkMode);
            
            if (isDarkMode) {
                if (modeToggle) modeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                if (modeToggle) modeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // Handle font size change
        function handleFontSizeChange() {
            currentFontSize = fontSizeSlider.value;
            if (fontSizeValue) fontSizeValue.textContent = `${currentFontSize}px`;
            document.body.style.fontSize = `${currentFontSize}px`;
            localStorage.setItem('fontSize', currentFontSize);
        }

        // Update profile form
        function updateProfileForm() {
            const savedName = localStorage.getItem('userName');
            const savedEmail = localStorage.getItem('userEmail');
            const savedPhone = localStorage.getItem('userPhone');
            const savedGrade = localStorage.getItem('userGrade');
            const savedBranch = localStorage.getItem('userBranch');
            
            if (savedName && nameInput) nameInput.value = savedName;
            if (savedEmail && emailInput) emailInput.value = savedEmail;
            if (savedPhone && phoneInput) phoneInput.value = savedPhone;
            if (savedGrade && gradeInput) gradeInput.value = savedGrade;
            if (savedBranch && branchInput) branchInput.value = savedBranch;
            
            toggleBranchField(savedGrade || '');
        }

        // Handle profile update
        function handleProfileUpdate(e) {
            e.preventDefault();
            
            const name = nameInput.value;
            const email = emailInput.value;
            const phone = phoneInput.value;
            const grade = gradeInput.value;
            const branch = branchInput.value;
            
            // Save to localStorage
            localStorage.setItem('userName', name);
            localStorage.setItem('userEmail', email);
            localStorage.setItem('userPhone', phone);
            localStorage.setItem('userGrade', grade);
            localStorage.setItem('userBranch', branch);
            
            // Update UI
            if (profileName) profileName.textContent = name;
            if (menuUserName) menuUserName.textContent = name;
            if (profileEmail) profileEmail.textContent = email;
            if (studyLevel) studyLevel.textContent = `الصف: ${grade}`;
            if (studyBranch) studyBranch.textContent = `الشعبة: ${branch}`;
            if (studyLevelMaterials) studyLevelMaterials.textContent = `الصف: ${grade}`;
            if (studyBranchMaterials) studyBranchMaterials.textContent = `الشعبة: ${branch}`;
            if (booksCategory) booksCategory.textContent = `الصف: ${grade}`;
            if (booksBranch) booksBranch.textContent = `الشعبة: ${branch}`;
            if (examsCategory) examsCategory.textContent = `الصف: ${grade}`;
            if (examsBranch) examsBranch.textContent = `الشعبة: ${branch}`;
            
            // Update currentUser
            currentUser = {
                ...currentUser,
                name: name,
                email: email,
                phone: phone,
                grade: grade,
                branch: branch
            };
            
            // Reload materials and books if grade or branch changed
            if (grade && branch) {
                loadStudyMaterials(grade, branch);
                loadMaterialsList(grade, branch);
                loadStudyBooks(grade, branch);
                loadExams(grade, branch);
            }
            
            showToast(currentLanguage === 'ar' ? 'تم حفظ التغييرات' : 'Changes saved');
            playSuccessSound();
        }

        // Handle profile image upload
        function handleProfileImageUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const imageData = event.target.result;
                    
                    // Update profile image
                    if (profileImage) profileImage.innerHTML = `<img src="${imageData}" alt="Profile Image">`;
                    if (menuUserAvatar) menuUserAvatar.innerHTML = `<img src="${imageData}" alt="Profile Image">`;
                    
                    // Save to localStorage
                    localStorage.setItem('profileImage', imageData);
                    
                    showToast(currentLanguage === 'ar' ? 'تم تحديث الصورة' : 'Profile image updated');
                };
                reader.readAsDataURL(file);
            }
        }

        // Save settings
        function saveSettings() {
            // Language is already saved in handleLanguageChange
            // Dark mode is already saved in handleDarkModeToggle
            // Font size is already saved in handleFontSizeChange
            
            showToast(currentLanguage === 'ar' ? 'تم حفظ الإعدادات' : 'Settings saved');
            playSuccessSound();
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
